name: Auto PR with Random File

on:
  workflow_dispatch:
    inputs:
      auto_merge:
        description: 'Enable auto-merge after PR is created'
        required: false
        default: 'false'
      delete_branch:
        description: 'Delete branch after merge'
        required: false
        default: 'false'

jobs:
  create-pr:
    runs-on: ubuntu-latest
    env:
      BRANCH_NAME: temp/random-file-${{ github.run_id }}

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          ref: main
          persist-credentials: false

      - name: Create a random file
        run: |
          echo "This file was created at $(date)" > random-${{ github.run_id }}.txt

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          branch: ${{ env.BRANCH_NAME }}
          base: main
          title: "chore: add random file"
          body: "This is an auto-generated file added by workflow run ${{ github.run_id }}."
          commit-message: "chore: add random file"
          delete-branch: ${{ github.event.inputs.delete_branch }}
          draft: false

      - name: Enable auto-merge (optional)
        if: ${{ github.event.inputs.auto_merge == 'true' && steps.cpr.outputs.pull-request-number != '' }}
        run: |
          gh pr merge ${{ steps.cpr.outputs.pull-request-number }} --merge --delete-branch
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
